1. Grid Snapping and Crossing Points
(a) Always use the nearest grid station as the endpoint for integration?

No. BMAP does not simply use the nearest grid station as the endpoint. Instead, BMAP interpolates to find the precise crossing point of the contour.

If the contour crosses between two stations, BMAP interpolates to find the exact
ğ‘¥
x-coordinate and corresponding elevation where the crossing occurs.

This improves accuracy because the crossing point might not align exactly with the grid points. The nearest station is not always the best estimate.

(b) Interpolate a new station at the exact crossing point and include it in the integration?

Yes, BMAP interpolates at the exact crossing point to estimate the contour crossing more accurately, especially if the crossing falls between grid points.

Linear interpolation is typically used to estimate the height and determine if the contour is crossed between two stations.

This interpolation allows BMAP to get better resolution at crossing points and avoid over-simplifying the integration.

(c) Use a hybrid approach (e.g., only interpolate if the crossing is very close to a station)?

Yes, BMAP may use a hybrid approach. If the contour crossing is near a grid point, interpolation might only be applied if the crossing point is close to a station. This ensures computational efficiency while maintaining accuracy where it matters most.

Profile Endpoints (above contour but not exactly on grid):

If the profile endpoint is above the contour but does not fall exactly on a grid station, BMAP will extend the integration to the endpoint. The entire segment will be included in the volume above the contour, regardless of whether it aligns with the grid stations. This ensures volume continuity.

2. Vertical and Nearly-Vertical Segments
Minimum Threshold for
ğ‘‘
ğ‘¥
dx on Nearly-Vertical Segments:

BMAP does not apply a minimum threshold for
ğ‘‘
ğ‘¥
dx in typical use. It will include any non-zero
ğ‘‘
ğ‘¥
dx, even if itâ€™s very small.

The idea is to include all data, even if the segment is very nearly vertical (i.e.,
ğ‘‘
ğ‘¥
dx is tiny but not zero).

This may lead to very small volume contributions for nearly-vertical segments, especially in cases where
ğ‘‘
ğ‘¥
dx is close to zero. However, the overall effect should be minimal for typical profiles.

True Vertical Wall at Endpoint:

If the profile has a true vertical wall (where two consecutive
ğ‘¥
x-values are identical, e.g., at the endpoint), BMAP does not include any area for this segment.

Reasoning: If
ğ‘¥
ğ‘–
=
ğ‘¥
ğ‘–
+
1
x
i
	â€‹

=x
i+1
	â€‹

, thereâ€™s no horizontal distance between them, so the area is zero (since the trapezoidal rule requires non-zero
ğ‘‘
ğ‘¥
dx for integration).

This behavior prevents overestimation of volume from vertical walls.

3. Flat/Stepwise Regions and Double-Counting
(a) Integrate Each Segment Separately (Possible Double-Counting)?

Yes, in stepwise profiles (where each step is above the contour), BMAP will integrate each segment separately.

Each step above the contour will be treated as a distinct region, and the areas will be summed. If two adjacent segments share a common
ğ‘¥
x-value, BMAP will ensure no double-counting by not including the overlapping region again.

The segments will not contribute redundantly to the volume.

(b) Merge the Segments into a Single Region for Integration?

No, BMAP will not merge adjacent above-contour regions automatically. Each region above the contour is treated separately for volume integration.

Flat Region Followed by a Drop Below Contour:

Yes, the area for the flat region above the contour is always included, even if thereâ€™s a drop below the contour immediately after.

Reasoning: The flat region above the contour contributes to the total volume, and the drop below it is a separate region (handled separately for volume).

The drop below the contour will contribute zero area, but the flat region above the contour will still be part of the total volume.

4. Edge Handling and Profile Endpoints
(a) Extrapolate to Endpoint and Include Area?

Yes, if the profile starts or ends above the contour, and if the profile endpoint is not exactly on a grid station, BMAP extends the integration to the endpoint. The segment will be included in the volume calculation.

This ensures that partial regions near the edges are properly accounted for.

(b) Only Integrate Up to the First/Last Grid Station?

No, BMAP includes the entire region from the last grid station to the profile endpoint, even if it doesnâ€™t align with the grid.

This helps prevent under-integration of partial regions at the edges.

Guardrails to Prevent Over-Integration?

BMAP has no explicit guardrails for over-integration, but segment length constraints (e.g., requiring a minimum segment length for integration) are typically handled through data pre-processing. However, extreme cases like vertical walls or duplicate points should be filtered out.

5. Interpolation and Resampling
Linear Interpolation vs Higher-Order Methods:

BMAP typically uses linear interpolation for resampling the profiles to a fixed grid.

Higher-order methods (like spline interpolation) are not typically used unless explicitly required for higher accuracy, but they may be useful for very noisy or irregular data.

Irregular Sampling:

Yes, BMAP always resamples the profile to a uniform grid before performing integration. This ensures that all profiles are compared on the same basis and that the integration is valid.

Irregularly spaced profiles can cause misalignments, so BMAP interpolates to a fixed grid (e.g., 5 ft or 10 ft intervals).

6. Negative Differences (Python < BMAP)
Reason for Area Differences:

The most likely cause of a discrepancy between Python and BMAP is due to the grid resolution used by each implementation.

BMAP may use a finer grid than the Python code, leading to more accurate calculations of small areas.

Additionally, BMAP may include more of the edge or endpoint areas (which might not be handled as thoroughly in Python).

Other Possible Reasons:

There could also be small differences in how the contour crossing is handled, particularly if Python does not resample as finely or miscalculates edge conditions (e.g., if it stops at the first station or doesn't interpolate across an endpoint).

Conclusion:

Grid snapping is a key feature, and BMAP uses interpolation to handle crossings accurately.

Vertical and stepwise regions can cause small biases due to small
ğ‘‘
ğ‘¥
dx values, but BMAP handles these well by treating them as separate regions and excluding vertical walls.

Flat regions above the contour are included in the volume, but dips below the contour are excluded.

End-point handling is robust, and partial regions at the edges are integrated correctly.

For the Python implementation, ensuring that you handle edge cases (vertical walls, stepwise regions, endpoint extrapolation) will help achieve better alignment with BMAP's results. Let me know if you need code adjustments based on this feedback!
